"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var coc_nvim_1 = require("coc.nvim");
var vscode_languageserver_protocol_1 = require("vscode-languageserver-protocol");
var svgo_1 = tslib_1.__importDefault(require("svgo"));
function svgMinify() {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var optimizer, document;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    optimizer = new svgo_1.default({});
                    return [4 /*yield*/, coc_nvim_1.workspace.getCurrentState()];
                case 1:
                    document = (_a.sent()).document;
                    optimizer.optimize(document.getText()).then(function (result) {
                        var range = vscode_languageserver_protocol_1.Range.create(vscode_languageserver_protocol_1.Position.create(0, 0), vscode_languageserver_protocol_1.Position.create(document.lineCount, 0));
                        var doc = coc_nvim_1.workspace.getDocument(document.uri);
                        doc.applyEdits(coc_nvim_1.workspace.nvim, [{
                                range: range,
                                newText: result.data
                            }]);
                    }).catch(function (err) {
                        coc_nvim_1.workspace.showMessage((err.message || err).replace(/\r?\n/g, ' '));
                    });
                    return [2 /*return*/];
            }
        });
    });
}
exports.svgMinify = svgMinify;
//# sourceMappingURL=svgMinify.js.map