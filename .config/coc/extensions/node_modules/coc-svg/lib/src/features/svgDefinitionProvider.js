"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var coc_nvim_1 = require("coc.nvim");
var vscode_languageserver_protocol_1 = require("vscode-languageserver-protocol");
var utils = tslib_1.__importStar(require("./utils"));
var SvgDefinitionProvider = /** @class */ (function () {
    function SvgDefinitionProvider() {
    }
    SvgDefinitionProvider.prototype.provideDefinition = function (document, position, token) {
        var doc = coc_nvim_1.workspace.getDocument(document.uri);
        var idRefRange = doc.getWordRangeAtPosition(position, '="\'(#)');
        if (idRefRange && !utils.isRangeEmpty(idRefRange)) {
            var word = document.getText(idRefRange);
            if (/url\(#[^\)\r\n]+\)/.test(word)) {
                var m = word.match(/url\(#([^)]+)\)/);
                if (m && m['1']) {
                    var id = m['1'].trim();
                    var body = document.getText();
                    var definePoint = body.indexOf(' id="' + id + '"');
                    if (definePoint > 0) {
                        var startTag = utils.getInStartTagFromOffset(token, body, definePoint);
                        if (startTag) {
                            var pos = document.positionAt(startTag.index);
                            return vscode_languageserver_protocol_1.Location.create(document.uri, { start: pos, end: pos });
                        }
                    }
                }
            }
            else if (/href=("|')[^\1]+\1/.test(word)) {
                var body = document.getText();
                var idRef = document.getText(idRefRange);
                var id = idRef.slice(7, -1);
                var definePoint = body.indexOf(' id="' + id + '"');
                if (definePoint <= 0) {
                    definePoint = body.indexOf(" id='" + id + "'");
                }
                if (definePoint > 0) {
                    var startTag = utils.getInStartTagFromOffset(token, body, definePoint);
                    if (startTag) {
                        var pos = document.positionAt(startTag.index);
                        return vscode_languageserver_protocol_1.Location.create(document.uri, { start: pos, end: pos });
                    }
                }
            }
        }
        return null;
    };
    return SvgDefinitionProvider;
}());
exports.SvgDefinitionProvider = SvgDefinitionProvider;
//# sourceMappingURL=svgDefinitionProvider.js.map